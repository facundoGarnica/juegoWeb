{% extends 'base.html.twig' %}
{% block title %}CodeGames{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/home.css') }}">
    <link rel="icon" href="{{ asset('images/favicon.ico') }}" type="image/x-icon">
{% endblock %}
{% block body %}
<a href="{{ path('app_formularios') }}">
    <button>Menu Formularios</button>
</a>
<h1 id="titulo">[#] CodeGames [#]</h1>


<!-- Mensajes flash -->
{% for message in app.flashes('error') %}
    <div style="background: red; color: white; padding: 10px; margin: 10px 0;">
        Error: {{ message }}
    </div>
{% endfor %}
{% for message in app.flashes('info') %}
    <div style="background: blue; color: white; padding: 10px; margin: 10px 0;">
        Info: {{ message }}
    </div>
{% endfor %}
{% for message in app.flashes('success') %}
    <div style="background: green; color: white; padding: 10px; margin: 10px 0;">
        Éxito: {{ message }}
    </div>
{% endfor %}

<p id="descripcion">
    Bienvenido a <strong>CodeJuegos</strong>, un playground de juegos.  
    Proyectos creados desde cero por Facu y Marian, combinando programación y análisis.  
    Explora y danos un feedback
</p>


<div id="BienvenidoUser">
    {% if app.user %}
        <p>Bienvenido, {{ app.user.username }}!</p>
        <a href="{{ path('app_logout') }}">Cerrar sesión</a>
    {% else %}
        <p>Iniciar sesión o registrarses</p>
        <a href="#" id="openModal">Iniciar sesión</a>
        <a href="#" id="openRegisterModal">Registrarse</a>
    {% endif %}
</div>

<div id="contenedor_menu">
    <button id="nosotros">Sobre nosotros</button>
    <button id="detrasEscenas">Detrás de escenas</button>
    <button id="contacto">Contacto</button>
</div>

<div id="CarruselJuegos">
    <h2>Nuestros Juegos</h2>
    <div class="carousel">
        {% for game in games %}
            <div class="carousel-item {% if loop.first %}active{% endif %}" data-game-id="{{ game.id }}">
                <img alt="{{ game.nombre }}" src="{{ asset('images/' ~ game.imagenPortada) }}" title="{{ game.nombre }}">
                <div class="play-overlay">
                    JUGAR
                </div>
            </div>
        {% endfor %}
    </div>
    <button class="carousel-control prev" id="prevBtn">&#10094;</button>
    <button class="carousel-control next" id="nextBtn">&#10095;</button>
</div>

<script>
    const userId = {{ app.user ? app.user.id : null }};
    console.log('userId definido como:', userId, 'tipo:', typeof userId);
</script>

<section id="topMejores">
    <h2>Top Mejores 4 puntajes</h2>
    <div id="topScoresContainer">
        <p>Selecciona un juego para ver los mejores puntajes.</p>
    </div>
</section>

<!-- Modal de Registro - CORREGIDO -->
<div id="modalRegister" class="modal" style="display:none;">
    <div class="modal-content">
        <span id="closeRegisterModal">&times;</span>
        <h2>Registro</h2>
        <!-- AGREGAR ACTION AL FORMULARIO -->
        {{ form_start(registrationForm, {
            'attr': {
                'id': 'registrationFormModal',
                'action': path('app_register')
            }
        }) }}
            {{ form_row(registrationForm.username) }}
            <div class="error" id="error-username"></div>
            
            {{ form_row(registrationForm.email) }}
            <div class="error" id="error-email"></div>
            
            {{ form_row(registrationForm.plainPassword, { label: 'Password' }) }}
            <div class="error" id="error-plainPassword"></div>
            
            <button type="button" id="togglePasswordModal" class="btn btn-secondary mt-2">Mostrar Contraseña</button>
            <button type="submit" class="btn btn-primary mt-2">Registrar</button>
        {{ form_end(registrationForm) }}
    </div>
</div>
<!-- Modal de Login -->
<div id="modalLogin" class="modal" style="display:none;">
    <div class="modal-content">
        <span id="closeModal">&times;</span>
        <h2>Iniciar Sesión</h2>

        {% if error %}
            <div class="alert alert-danger">{{ error.messageKey|trans(error.messageData, 'security') }}</div>
        {% endif %}

        <form method="post" action="{{ path('app_login_check') }}">
            <div class="mb-3">
                <label for="inputEmail" class="form-label">Correo electrónico</label>
                <input type="email" value="{{ last_username }}" name="_username" id="inputEmail" class="form-control" autocomplete="email" required autofocus>
            </div>

            <div class="mb-3">
                <label for="inputPassword" class="form-label">Contraseña</label>
                <input type="password" name="_password" id="inputPassword" class="form-control" autocomplete="current-password" required>
            </div>

            <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">
            
            <button type="button" id="togglePasswordLogin" class="btn btn-secondary mt-2">Mostrar Contraseña</button>
            <button class="btn btn-primary" type="submit">Iniciar Sesión</button>
        </form>
    </div>
</div>

<!-- Modal cartel de error -->
<div id="modalError">
    <div class="modal-box">
        <p>Se debe iniciar sesión para jugar.</p>
        <button id="closeErrorModal">Cerrar</button>
    </div>
</div>


<footer id="footer">
    <p>Seguinos en:</p>
    <ul>
        <li><a href="https://www.facebook.com/ArrayRun">Facebook</a></li>
        <li><a href="https://www.twitter.com/ArrayRun">Twitter</a></li>
        <li><a href="https://www.instagram.com/ArrayRun">Instagram</a></li>
    </ul>
</footer>

<script src="{{ asset('js/home.js') }}"></script>

<script>

</script>
{% endblock %}